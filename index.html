<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bafna Lights - Stock</title>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;}
header{background:#007AFF;color:white;padding:15px;text-align:center;font-size:22px;}
.container{max-width:1000px;margin:auto;padding:20px;}
.card{background:white;padding:15px;border-radius:10px;margin-bottom:20px;}
input,select,button{width:100%;padding:10px;margin:8px 0;}
button{background:#007AFF;color:white;border:none;cursor:pointer;}
table{width:100%;border-collapse:collapse;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
th{background:#007AFF;color:white;}
#dashboard{display:none;}
</style>
</head>

<body>

<header>Bafna Lights Stock</header>

<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">

<h3>Admin Login</h3>

<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">

<button onclick="login()">Login</button>

</div>


<!-- DASHBOARD -->
<div id="dashboard">

<!-- STOCK -->
<div class="card">

<h3>Current Stock</h3>

<table>
<tr><th>Item</th><th>Stock</th></tr>
<tbody id="stockTable"></tbody>
</table>

</div>


<!-- ADD ITEM -->
<div class="card">

<h3>Add Item</h3>

<input id="itemName" placeholder="Item Name">
<select id="itemCategory">
<option>Street Light</option>
<option>Flood Light</option>
</select>
<input id="openingStock" type="number" placeholder="Opening Stock">

<button onclick="addItem()">Save Item</button>

</div>


<!-- PURCHASE -->
<div class="card">

<h3>Add Parts</h3>

<input id="partName" placeholder="Part Name">
<input id="partQty" type="number" placeholder="Quantity">

<button onclick="addPart()">Save Part</button>

</div>


<!-- PRODUCTION -->
<div class="card">

<h3>Production</h3>

<select id="prodItem"></select>
<input id="prodQty" type="number" placeholder="Quantity">

<button onclick="addProduction()">Save</button>

</div>


<!-- SALES -->
<div class="card">

<h3>Sale</h3>

<select id="saleItem"></select>
<input id="saleQty" type="number" placeholder="Quantity">
<input id="party" placeholder="Party">

<button onclick="addSale()">Save</button>

</div>


<button onclick="logout()">Logout</button>

</div>

</div>


<script>

const API="https://stock-1-eyzx.onrender.com";

let TOKEN="";


// LOGIN
async function login(){

let res = await fetch(API+"/api/login",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  username:username.value,
  password:password.value
 })
});

let data = await res.json();

if(res.ok){

 TOKEN=data.access_token;

 loginBox.style.display="none";
 dashboard.style.display="block";

 loadItems();

}else{
 alert("Login Failed");
}

}


// LOAD ITEMS
async function loadItems(){

let res = await fetch(API+"/api/items");
let items = await res.json();

stockTable.innerHTML="";
saleItem.innerHTML="";
prodItem.innerHTML="";

items.forEach(i=>{

 let tr=document.createElement("tr");
 tr.innerHTML=`<td>${i.name}</td><td>${i.stock}</td>`;
 stockTable.appendChild(tr);

 let op=document.createElement("option");
 op.value=i.name;
 op.text=i.name;

 saleItem.appendChild(op.cloneNode(true));
 prodItem.appendChild(op.cloneNode(true));

});

}


// ADD ITEM
async function addItem(){

if(!itemName.value){ alert("Enter name"); return;}

await fetch(API+"/api/items",{
 method:"POST",
 headers:{
  "Content-Type":"application/json"
 },
 body:JSON.stringify({
  name:itemName.value,
  category:itemCategory.value,
  opening_stock:Number(openingStock.value)
 })
});

alert("Item Added");
loadItems();

itemName.value="";
openingStock.value="";

}


// ADD PART
async function addPart(){

if(!partName.value||!partQty.value){ alert("Fill all"); return;}

await fetch(API+"/api/purchase",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  part_name:partName.value,
  quantity:Number(partQty.value)
 })
});

alert("Part Added");

partName.value="";
partQty.value="";

}


// PRODUCTION
async function addProduction(){

await fetch(API+"/api/production",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  item_name:prodItem.value,
  quantity:Number(prodQty.value)
 })
});

alert("Saved");
loadItems();

}


// SALE
async function addSale(){

await fetch(API+"/api/sales",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  item_name:saleItem.value,
  quantity:Number(saleQty.value),
  party:party.value
 })
});

alert("Saved");
loadItems();

}


// LOGOUT
function logout(){

dashboard.style.display="none";
loginBox.style.display="block";

}

</script>

</body>
</html>
